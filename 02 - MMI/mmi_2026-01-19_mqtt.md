# MQTT
___
> Message Queuing Telemetry Transport

- IOT standard messaging protocol
- Lightweight publish/subscribe messaging transport
- Minimal network bandwidth

## QoS levels

> 3 defined **quality of service** levels (how reliable messages are delivered between publisher & subscriber)
	- 0: at most once (fire and forget)
	- 1: at least once (requires acknowledgement - PUBACK)
	- 2: exactly once (two-phase handshake - PUBREC → PUBREL → PUBCOMP)

| QoS Level | Guarantee     | Duplicates | Overhead |
| --------- | ------------- | ---------- | -------- |
| QoS 0     | At most once  | Possible   | Low      |
| QoS 1     | At least once | Possible   | Medium   |
| QoS 2     | Exactly once  | No         | High     |

### QoS 2(2-phase Handshake)
#### Message Flow
##### Phase 1 - Message receipt
1. Publish (QoS 2)
	- Sender → Receiver
	- Contains message + packet identifier
2. PUBREC (Publish received)
	- Receiver → Sender
	- Confirms message was received
	- Message is stored but not yet delivered to app

##### Phase 2 - Message release
3. PUBREL (Publish release)
	- Sender → Receiver
	- Instructs receiver to release (process) message
4. PUBCOMP (Publish complete)
	- Receiver → Sender
	- Confirms successful processing
	- Both sides delete stored message state

#### Guarantee
- Receiver stores message after `PUBLISH`
- Only delivered to app after `PUBREL`
- Packet identifiers ensure duplicates are detected
- If packet is list, MQTT retransmits safely without re-processing

#### Trade-offs
- Higher latency
- More network and memory overhead

[more](https://mqtt.org)